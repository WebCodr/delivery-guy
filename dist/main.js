"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},asyncToGenerator=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function r(o,i){try{var c=t[o](i),u=c.value}catch(e){return void n(e)}if(!c.done)return Promise.resolve(u).then(function(e){r("next",e)},function(e){r("throw",e)});e(u)}("next")})}},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},getResponseBody=function(e){try{return"string"==typeof e.body?JSON.parse(e.body):e.body}catch(t){return e.body}},getErrorMessage=function(e){return"The request to "+e.url+" failed with HTTP "+e.status+": "+e.statusText},ResponseError=function(e){function t(e){classCallCheck(this,t);var n=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,getErrorMessage(e)));return n.response=e,n.responseBody=getResponseBody(e),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(n,t),n}return inherits(t,e),t}(Error);Function.prototype.$asyncbind=function e(t,n){function r(){return o.apply(t,arguments)}Function.prototype.$asyncbind||Object.defineProperty(Function.prototype,"$asyncbind",{value:e,enumerable:!1,configurable:!0,writable:!0}),e.trampoline||(e.trampoline=function(e,t,n,r,o){return function i(c){for(;c;){if(c.then)return c=c.then(i,r),o?void 0:c;try{if(c.pop){if(c.length)return c.pop()?t.call(e):c;c=n}else c=c.call(e)}catch(e){return r(e)}}}}),e.LazyThenable||(e.LazyThenable=function(){function e(e){return e&&e instanceof Object&&"function"==typeof e.then}function t(n,r,o){try{var i=o?o(r):r;if(n===i)return n.reject(new TypeError("Promise resolution loop"));e(i)?i.then(function(e){t(n,e)},function(e){n.reject(e)}):n.resolve(i)}catch(e){n.reject(e)}}function n(e){}function r(){}function o(n,o){var i=new r;try{this._resolver(function(r){return e(r)?r.then(n,o):t(i,r,n)},function(e){t(i,e,o)})}catch(e){t(i,e,o)}return i}function i(e){this._resolver=e,this.then=o}return r.prototype={resolve:n,reject:n,then:function(e,t){this.resolve=e,this.reject=t}},i.resolve=function(e){return i.isThenable(e)?e:{then:function(t){return t(e)}}},i.isThenable=e,i}(),e.EagerThenable=e.Thenable=(e.EagerThenableFactory=function(e){e=e||"object"===("undefined"==typeof process?"undefined":_typeof(process))&&process.nextTick||"function"==typeof setImmediate&&setImmediate||function(e){setTimeout(e,0)};var t=function(){var t=[],n=0,r=1024;function o(){for(;t.length-n;){try{t[n]()}catch(e){}t[n++]=void 0,n===r&&(t.splice(0,r),n=0)}}return function(r){t.push(r),t.length-n==1&&e(o)}}();function n(e){if(e){var t=this;e(function(e){t.resolve(e)},function(e){t.reject(e)})}}function r(e,t){if("function"==typeof e.y)try{var n=e.y.call(void 0,t);e.p.resolve(n)}catch(t){e.p.reject(t)}else e.p.resolve(t)}function o(e,t){if("function"==typeof e.n)try{var n=e.n.call(void 0,t);e.p.resolve(n)}catch(t){e.p.reject(t)}else e.p.reject(t)}return n.prototype={resolve:function(e){if(void 0===this.state){if(e===this)return this.reject(new TypeError("Attempt to resolve promise with self"));var n=this;if(e&&("function"==typeof e||"object"===(void 0===e?"undefined":_typeof(e))))try{var o=0,i=e.then;if("function"==typeof i)return void i.call(e,function(e){o++||n.resolve(e)},function(e){o++||n.reject(e)})}catch(e){return void(o||this.reject(e))}this.state=r,this.v=e,n.c&&t(function(){for(var t=0,o=n.c.length;t<o;t++)r(n.c[t],e)})}},reject:function(e){if(void 0===this.state){this.state=o,this.v=e;var n=this.c;n&&t(function(){for(var t=0,r=n.length;t<r;t++)o(n[t],e)})}},then:function(e,r){var o=new n,i={y:e,n:r,p:o};if(void 0===this.state)this.c?this.c.push(i):this.c=[i];else{var c=this.state,u=this.v;t(function(){c(i,u)})}return o}},n.resolve=function(e){if(e&&e instanceof n)return e;var t=new n;return t.resolve(e),t},n.reject=function(e){if(e&&e instanceof n)return e;var t=new n;return t.reject(e),t},n.version="2.3.3-nodent",n})());var o=this;switch(n){case!0:return new e.Thenable(r);case 0:return new e.LazyThenable(r);case void 0:return r.then=r,r;default:return function(){try{return o.apply(t,arguments)}catch(e){return n(e)}}}};var checkResponse=function(e){if(!e.ok)throw new ResponseError(e)},deliver=function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,n){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,n);case 2:return r=e.sent,checkResponse(r),e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),deliverJson=function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(t,n){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,deliver(t,n);case 2:return r=e.sent,e.abrupt("return",r.json());case 4:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}();exports.deliver=deliver,exports.deliverJson=deliverJson;
